import{p as ne,S as te}from"./index-c9d79b38.js";import{S as ae}from"./index-02c5e8b4.js";import{I as se}from"./index-033b4f4e.js";import{p as ie,P as re}from"./index-8a80d414.js";import{d as le,p as E,c as ce,a as D,m as ue}from"./components-b798c95f.js";import{d as pe,a as v,b as me,w as de,Z as F,_ as he,p as Y,f as O,i as N,S as $,q as ve,m as ge,h as M,F as fe,ai as we,N as g,M as P,R as Te,O as R,Q as L,j as U,at as Ce,r as Se,n as ye,W as Ie,ax as Oe}from"./vue-router-0bbd6486.js";const ke={show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":le(),...E(ne,["loop","indicator","onChange"]),...E(ie,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])},{n:W,classes:Ye}=ce("image-preview"),q=12,H=200,$e=350,Z=200,De=pe({name:"VarImagePreview",components:{VarSwipe:te,VarSwipeItem:ae,VarPopup:re,VarIcon:se},inheritAttrs:!1,props:ke,setup(e){const l=v(!1),i=me(()=>{const{images:o,current:t}=e,n=o.findIndex(s=>s===t);return n>=0?n:0}),c=v(1),h=v(0),T=v(0),C=v(void 0),S=v(void 0),y=v(!0);let p=null,a=null,r=null;const X=(o,t)=>{const{clientX:n,clientY:s}=o,{clientX:u,clientY:m}=t;return Math.abs(Math.sqrt((u-n)**2+(m-s)**2))},z=(o,t)=>({clientX:o.clientX,clientY:o.clientY,timestamp:Date.now(),target:t}),j=()=>{c.value=F(e.zoom),y.value=!1,a=null,window.setTimeout(()=>{C.value="linear",S.value="0s"},Z)},V=()=>{c.value=1,h.value=0,T.value=0,y.value=!0,a=null,C.value=void 0,S.value=void 0},Q=o=>a?X(a,o)<=q&&o.timestamp-a.timestamp<=H&&a.target===o.target:!1,G=o=>!o||!p||!a?!1:X(p,a)<=q&&Date.now()-a.timestamp<$e&&(o===p.target||o.parentNode===p.target),J=o=>{r=window.setTimeout(()=>{G(o.target)&&B(),p=null},H)},K=o=>{r&&window.clearTimeout(r);const{touches:t}=o,n=z(t[0],o.currentTarget);if(p=n,Q(n)){c.value>1?V():j();return}a=n},b=o=>{const{offsetWidth:t,offsetHeight:n}=o,{naturalWidth:s,naturalHeight:u}=o.querySelector(`.${W("image")}`);return{width:t,height:n,imageRadio:u/s,rootRadio:n/t,zoom:F(e.zoom)}},_=o=>{const{zoom:t,imageRadio:n,rootRadio:s,width:u,height:m}=b(o);if(!n)return 0;const I=n>s?m/n:u;return Math.max(0,(t*I-u)/2)/t},x=o=>{const{zoom:t,imageRadio:n,rootRadio:s,width:u,height:m}=b(o);if(!n)return 0;const I=n>s?m:u*n;return Math.max(0,(t*I-m)/2)/t},A=(o,t,n)=>o+t>=n?n:o+t<=-n?-n:o+t,ee=o=>{if(!a)return;const t=o.currentTarget,{touches:n}=o,s=z(n[0],t);if(c.value>1){const u=s.clientX-a.clientX,m=s.clientY-a.clientY,I=_(t),oe=x(t);h.value=A(h.value,u,I),T.value=A(T.value,m,oe)}a=s},B=()=>{if(c.value>1){V(),setTimeout(()=>D(e["onUpdate:show"],!1),Z);return}D(e["onUpdate:show"],!1)};return de(()=>e.show,o=>{l.value=o},{immediate:!0}),{n:W,classes:Ye,initialIndex:i,popupShow:l,scale:c,translateX:h,translateY:T,canSwipe:y,transitionTimingFunction:C,transitionDuration:S,handleTouchstart:K,handleTouchmove:ee,handleTouchend:J,close:B}}});const Ne=["src","alt"];function Pe(e,l,i,c,h,T){const C=Y("var-swipe-item"),S=Y("var-swipe"),y=Y("var-icon"),p=Y("var-popup");return O(),N(p,{class:g(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:$(()=>[ve(S,ge({class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:$(()=>[(O(!0),M(fe,null,we(e.images,a=>(O(),N(C,{class:g(e.n("swipe-item")),"var-image-preview-cover":"",key:a},{default:$(()=>[P("div",{class:g(e.n("zoom-container")),style:Te({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:l[0]||(l[0]=(...r)=>e.handleTouchstart&&e.handleTouchstart(...r)),onTouchmove:l[1]||(l[1]=(...r)=>e.handleTouchmove&&e.handleTouchmove(...r)),onTouchend:l[2]||(l[2]=(...r)=>e.handleTouchend&&e.handleTouchend(...r))},[P("img",{class:g(e.n("image")),src:a,alt:a},null,10,Ne)],38)]),_:2},1032,["class"]))),128))]),indicator:$(({index:a,length:r})=>[R(e.$slots,"indicator",{index:a,length:r},()=>[e.indicator&&e.images.length>1?(O(),M("div",{key:0,class:g(e.n("indicators"))},L(a+1)+" / "+L(r),3)):U("",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),R(e.$slots,"close-icon",{},()=>[e.closeable?(O(),N(y,{key:0,class:g(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):U("",!0)]),P("div",{class:g(e.n("extra"))},[R(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const f=he(De,[["render",Pe]]);let d,k={};function Re(e={}){return Ie(e)?{...k,images:[e]}:Oe(e)?{...k,images:e}:{...k,...e}}function w(e){if(!Ce())return;w.close();const l=Re(e),i=Se(l);i.teleport="body",d=i;const{unmountInstance:c}=ue(f,i,{onClose:()=>D(i.onClose),onClosed:()=>{D(i.onClosed),c(),d===i&&(d=null)},onRouteChange:()=>{c(),d===i&&(d=null)},"onUpdate:show":h=>{i.show=h}});i.show=!0}w.close=()=>{if(d!=null){const e=d;d=null,ye().then(()=>{e.show=!1})}};w.setDefaultOptions=e=>{k=e};w.resetDefaultOptions=()=>{k={}};f.install=function(e){e.component(f.name,f)};w.install=function(e){e.component(f.name,f)};w.Component=f;export{w as I};
